<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>AJAX CRUD 도서 관리</title>
    <style>
        body {
            margin: 15px;
        }

        h2 {
            display: block;
            background-color: rgb(245, 219, 188);
            text-align: center;
            color:#503b3b;
            font-size: 50px;
            text-shadow:#ba8d8d 1px 2px;
            margin: 0px 0px 10px;
            padding: 20px;
        }

        h3 {
            color:#665b3d;
            font-size: 20px;
            margin-bottom: 0;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }

        th,
        td {
            border: 1px solid #ba8d8d;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #c7a9a9;
        }

        input {
            padding: 6px;
            margin: 4px;
            width: 100px;
        }


        button {
            padding: 10px;
            margin: 4px;
            background-color: #edbdbd;
            border-radius: 10%;
            border-color: beige;
            font-size: 14px;
        }

        button:hover {
            background-color: #ba8d8d;
        }

        .list {
            text-align: center;
        }

    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <h2>도서 목록</h2>

    <div class="list">
        <button id="btn_load">도서 목록 불러오기</button>
    </div>

    <h3>도서 추가</h3>
    제목: <input id="title" type="text">
    저자: <input id="author" type="text">
    연도: <input id="year" type="number">
    가격: <input id="price" type="number">
    <button id="btn_add">추가</button>

    <h3>도서 수정</h3>
    ID: <input id="edit_id" type="text">
    제목: <input id="edit_title" type="text">
    저자: <input id="edit_author" type="text">
    연도: <input id="edit_year" type="number"> 
    가격: <input id="edit_price" type="number">
    <button id="btn_update">수정</button>

    <h3>도서 삭제</h3>
    ID: <input id="delete_id" type="text">
    <button id="btn_delete">삭제</button>

    <h3>도서 목록</h3>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>제목</th>
                <th>저자</th>
                <th>연도</th>
                <th>가격</th>
            </tr>
        </thead>
        <tbody id="book_list"></tbody>
    </table>

    <script>
        const BASE_URL = "http://localhost:3000/books";

        $("#btn_load").click(function () {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", BASE_URL);
            xhr.send();
            xhr.onload = () => {
                if (xhr.status === 200) {
                    const data = JSON.parse(xhr.response);
                    let html = "";
                    data.forEach(b => {
                        html += `<tr>
                            <td>${b.id}</td>
                            <td>${b.title}</td>
                            <td>${b.author}</td>
                            <td>${b.year}</td>
                            <td>${b.price}</td>
                        </tr>`;
                    });
                    $("#book_list").html(html);
                } else {
                    alert("불러오기 실패");
                }
            };
        });

        $("#btn_add").click(function () {
            const newBook = {
                title: $("#title").val(),
                author: $("#author").val(),
                year: parseInt($("#year").val()),
                price: parseFloat($("#price").val())
            };

            const xhr = new XMLHttpRequest();
            xhr.open("POST", BASE_URL);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(JSON.stringify(newBook));

            xhr.onload = () => {
                if (xhr.status === 201) {
                    alert("도서 추가 완료!");
                    $("#btn_load").click();
                } else {
                    console.log(xhr.status, xhr.statusText);
                }
            };
        });

        $("#btn_update").click(function () {
            const id = $("#edit_id").val();
            const updateBook = {
                title: $("#edit_title").val(),
                author: $("#edit_author").val(),
                year: parseInt($("#edit_year").val()),  
                price: parseFloat($("#edit_price").val())
            };

            const xhr = new XMLHttpRequest();
            xhr.open("PUT", `${BASE_URL}/${id}`);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(JSON.stringify(updateBook));

            xhr.onload = () => {
                if (xhr.status === 200) {
                    alert("도서 수정 완료!");
                    $("#btn_load").click();
                } else {
                    console.log(xhr.status, xhr.statusText);
                }
            };
        });

        $("#btn_delete").click(function () {
            const id = $("#delete_id").val();
            if (!id) return alert("ID를 입력하세요");

            const xhr = new XMLHttpRequest();
            xhr.open("DELETE", `${BASE_URL}/${id}`);
            xhr.send();

            xhr.onload = () => {
                if (xhr.status === 200) {
                    alert("도서 삭제 완료");
                    $("#btn_load").click();
                } else {
                    console.log(xhr.status, xhr.statusText);
                }
            };
        });
    </script>
</body>

</html>